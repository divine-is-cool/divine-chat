<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Banned — Divine Chat</title>
  <link rel="stylesheet" href="/css/styles.css" />
  <style>
    /* minor adjustments to center ban message */
    .ban-container{max-width:900px;margin:36px auto;padding:40px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));box-shadow:0 20px 60px rgba(2,6,23,0.7);text-align:center}
    .ban-title{font-size:2rem;font-weight:800;margin:0 0 6px}
    .ban-sub{color:var(--muted);margin-bottom:18px}
    .ban-reason{margin-top:18px;color:var(--muted)}
    .ban-cta{margin-top:22px}
    .ban-cta .btn{min-width:160px}
  </style>
</head>
<body>
  <main class="container">
    <section class="ban-container">
      <h1 class="ban-title">You have been banned</h1>
      <p class="ban-sub">Due to swearing, you have been banned from using Divine Chat.</p>

      <div id="banInfo" style="font-weight:700"></div>
      <div id="banReason" class="ban-reason"></div>

      <div class="ban-cta">
        <button id="btnBack" class="btn muted">Back to Home</button>
        <button id="btnClearBan" class="btn gold">Clear Ban (Dev only)</button>
      </div>
    </section>
  </main>

  <script>
    // Reads the ban cookie and displays remaining time
    function getCookie(name) {
      const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
      return v ? decodeURIComponent(v.pop()) : null;
    }
    function removeCookie(name) {
      document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    }
    function loadSettingsTheme() {
      try {
        const raw = localStorage.getItem('divine_chat_settings_v2');
        if (!raw) return;
        const s = JSON.parse(raw);
        if (s && s.themeClass) document.body.classList.add(s.themeClass);
        if (s && s.theme === 'light') document.body.classList.add('light-mode');
      } catch {}
    }
    loadSettingsTheme();

    const banRaw = getCookie('divine_ban');
    const infoEl = document.getElementById('banInfo');
    const reasonEl = document.getElementById('banReason');
    let until = null;
    if (banRaw) {
      try {
        const payload = JSON.parse(banRaw);
        until = payload.until ? parseInt(payload.until,10) : null;
        const now = Date.now();
        if (until && until > now) {
          const diffMs = until - now;
          const hours = Math.ceil(diffMs / (1000*60*60));
          if (hours >= 24) {
            const days = Math.ceil(hours / 24);
            infoEl.textContent = `You are banned for ${days} day${days===1?'':'s'}.`;
          } else {
            infoEl.textContent = `You are banned for ${hours} hour${hours===1?'':'s'}.`;
          }
        } else {
          infoEl.textContent = 'Ban expired. Clearing...';
          // clear cookie and allow user to go back
          removeCookie('divine_ban');
        }
        if (payload.word) {
          reasonEl.textContent = `Reason: "${payload.word}" violation.`;
        }
      } catch (err) {
        infoEl.textContent = 'Banned — details unavailable.';
      }
    } else {
      infoEl.textContent = 'You are banned.';
    }

    document.getElementById('btnBack').addEventListener('click', () => {
      // back to index - if cookie present client will redirect back; user can remove cookie via devtools
      window.location.href = '/';
    });
    document.getElementById('btnClearBan').addEventListener('click', () => {
      // dev helper to clear ban cookie (for testing)
      removeCookie('divine_ban');
      alert('Ban cookie cleared (dev).');
      window.location.href = '/';
    });
  </script>
</body>
</html>
